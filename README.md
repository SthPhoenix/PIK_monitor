# PIK_monitor

Скрипт для автоматического мониторинга изменений личного кабинета (ЛК)
пользователя ГК ПИК.

Скрипт с заданной переодичностью проверяет данные API ЛК и в случае
обнаружения изменений отправляет в канал Телеграм уведомление со списком
зафиксированных изменений.

Для функционирования скрипта необходимо зарегистрировать телеграм-бота
и создать канал куда бот будет отправлять уведомления. В случае если канал
приватный, необходимо выяснить ID канала, так как приватные каналы не доступны
по имени.

## Параметры скрипта

Параметры можно задать либо в качестве переменных окружения:
1. TLG_TOKEN - токен бота телеграм
2. TLG_CHAT_ID - ID чата телеграма
3. PIK_LOGIN - логин ЛК ПИК
4. PIK_PASSWORD - пароль ЛК ПИК
5. DATA_DIR - путь к папке с конфигурацией и кэшем ( по умолчанию `data`)
6. MODE - режим работы (*single* - одиночное выполнение, *loop* - бесконечный цикл)
7. DELAY - задержка между итерациями в секундах (по умолчанию 600)

Учетные данные также можно задать с помощью файла `data/credentials.json`
(пример можно посмотреть в файле `data/credentials_template.json`),
однако в случае передачи переменных окружения, их значение будет приоритетным.

## Алгоритм работы

При первом запуске скрипт получит токен авторизации ЛК, проверит список доступных к
отслеживанию параметров и запишет полученные данные в папку `data`, а так же отправит в канал
сообщение о начале мониторинга.

При последующих итерациях скрипт будет сравнивать данные записанные в
прошлый цикл в папку `data`, обновлять раз в сутки токен авторизации
и в случае фиксации обновлений отправлять сообщение со списком изменений
в канал телеграм.

При обнаружении изменений файлы в папке `data` будут заменены на свежую версию
и в следующую итерацию проверка будет осуществляться по уже новым файлам.

## Запуск с помощью Docker

Запуск осуществляется с помощью скрипта `run.sh`. Перед запуском
необходимо заменить параметры своими учетными данными, там где это указано.

Запуск выполняется в консоли командой:
```
bash run.sh
```
